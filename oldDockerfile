# syntax=docker/dockerfile:1
FROM golang:1.19

# update dependencies
RUN apt-get update
RUN apt-get install unzip protobuf
RUN go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.28
RUN go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.2
#RUN go install google.golang.org/grpc@latest
RUN PB_REL="https://github.com/protocolbuffers/protobuf/releases"
RUN curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v3.15.8/protoc-3.15.8-linux-x86_64.zip
RUN unzip protoc-3.15.8-linux-x86_64.zip -d $HOME/.local
RUN export PATH="$PATH:$HOME/.local/bin"
# copia la *intera* repo, per le interdipendenze
#ADD .
WORKDIR .
COPY    . .

#WORKDIR /APP
# build
RUN ./setup.sh
RUN cd bin
CMD ["./node", "-a", "b"]
